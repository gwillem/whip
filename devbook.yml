---
- hosts:
    - ubuntu@192.168.64.16
    # - root@192.168.64.17
  become: root
  vars:
    install:
      path: /data
      type: gunicorn
    plans:
      - large
      - medium
      - tiny

  tasks:
    # - lineinfile:
    #     path: /tmp/postfix/main.cf
    #     line: "inet_interfaces = 127.0.0.1"
    # - apt:
    #     name:
    #       - moreutils
    #       - xz-utils
    #       - git
    #       - atop state=absent
    #       - mlocate state=absent
    # - get_url: url=https://google.com/robots.txt dest=/tmp/google/robots.txt
    - command: "echo hoera a=b"

    # - name: install ssh keys
    #   authorized_key:
    #     user: ubuntu
    #     key: "{{item}}"
    #   loop:
    #   - abc
    #   - xyz

    - name: file sync
      tree:
        src: fixture/tree
        dst: /tmp
        /etc: notify=nginx owner=www-data
        /etc/nginx/nginx.conf: umask=077 owner=root
      vars:
        server: banaan

    - name: big file sync
      tree:
        src: build
        dst: /tmp

    # - service: name=cron state=restarted

    # - local_action: command hostname

    # - command:
    #     args: timedatectl set-timezone UTC
    #     unless: grep UTC /etc/timezone

    # - command:
    #     args: hostname
    # - name: install packages
    #   apt:
    #     state: latest
    #     name:
    #       - binutils
    #       - moreutils

    # - name: sleep random
    #   shell: sleep $( printf '0.%04d\n' $RANDOM )
    #   notify: nginx
    #   loop:
    #     - a

    # - shell: id

    # - name: testing vars
    # command: echo {{install.type}} {{plans| join(",")}}

    # - name: induced failure
    #   command: /bin/false

    # - name: sleep a bit
    #   command: echo hoi

    # - name: sleep a bit
    #   command: echo hoi

    # - name: sleep a bit
    #   command: /bin/true
    # - name: sync repo to prod
    #   synchronize:
    #     src: "x"
    #     dest: "y"
  # handlers:
  #   - name: nginx
  #     shell: echo restarting nginx
